---
# YouTube Live Chat Collector - ãƒ¡ã‚¤ãƒ³ä¸€æ‹¬ãƒ‡ãƒ—ãƒ­ã‚¤
# ä½œæˆæ—¥: 2025-08-23
# èª¬æ˜: å„å·¥ç¨‹ã®ãƒ—ãƒ¬ã‚¤ãƒ–ãƒƒã‚¯ã‚’é †æ¬¡å®Ÿè¡Œã—ã¦å…¨ã‚·ã‚¹ãƒ†ãƒ ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤

- name: YouTube Live Chat Collector - Complete System Deployment
  hosts: localhost
  connection: local
  gather_facts: yes
  
  vars:
    # ç’°å¢ƒè¨­å®š
    env_name: "dev"
    aws_region: "ap-northeast-1"
    
    # ãƒ‡ãƒ—ãƒ­ã‚¤åˆ¶å¾¡ãƒ•ãƒ©ã‚°
    deploy_lambda: true
    deploy_container: true
    deploy_frontend: true
    
    # å„å·¥ç¨‹ã®ãƒ—ãƒ¬ã‚¤ãƒ–ãƒƒã‚¯ãƒ‘ã‚¹
    playbook_dir: "{{ playbook_dir }}/playbooks"
    
---
# YouTube Live Chat Collector - ãƒ¡ã‚¤ãƒ³ä¸€æ‹¬ãƒ‡ãƒ—ãƒ­ã‚¤
# ä½œæˆæ—¥: 2025-08-23
# æ›´æ–°æ—¥: 2025-08-23 (CodeBuildçµ±åˆå¯¾å¿œ)
# èª¬æ˜: å„å·¥ç¨‹ã®ãƒ—ãƒ¬ã‚¤ãƒ–ãƒƒã‚¯ã‚’é †æ¬¡å®Ÿè¡Œã—ã¦å…¨ã‚·ã‚¹ãƒ†ãƒ ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤

- name: YouTube Live Chat Collector - Complete System Deployment
  hosts: localhost
  connection: local
  gather_facts: yes
  
  vars:
    # ç’°å¢ƒè¨­å®š
    env_name: "dev"
    aws_region: "ap-northeast-1"
    
    # ãƒ‡ãƒ—ãƒ­ã‚¤åˆ¶å¾¡ãƒ•ãƒ©ã‚°
    deploy_lambda: true
    deploy_container: true
    deploy_frontend: true
    
    # å„å·¥ç¨‹ã®ãƒ—ãƒ¬ã‚¤ãƒ–ãƒƒã‚¯ãƒ‘ã‚¹
    playbook_dir: "{{ playbook_dir }}/playbooks"
    
  tasks:
    - name: "ğŸš€ YouTube Live Chat Collector - Complete Deployment Started"
      debug:
        msg: |
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘          YouTube Live Chat Collector                         â•‘
          â•‘              Complete System Deployment                      â•‘
          â•‘                (CodeBuild Integration)                       â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          ğŸ“‹ Deployment Plan:
          âœ… Phase 1: Pre-checks (AWS CLI, Terraform state)
          âœ… Phase 2: Lambda Functions (4 functions)
          âœ… Phase 3: Container Deployment (CodeBuild â†’ ECR)
          âœ… Phase 4: Frontend Deployment (React â†’ S3)
          âœ… Phase 5: Post-verification (Integration tests)
          
          â±ï¸  Estimated Time: 5-8 minutes
          ğŸ—ï¸  Infrastructure: 113 AWS resources
          ğŸ³ Container Build: CodeBuild (1-2 minutes)
          
          Starting deployment...
          â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
          â•‘  Environment: {{ env_name }}                                 â•‘
          â•‘  AWS Region: {{ aws_region }}                                â•‘
          â•‘  Deploy Lambda: {{ deploy_lambda }}                          â•‘
          â•‘  Deploy Container: {{ deploy_container }}                    â•‘
          â•‘  Deploy Frontend: {{ deploy_frontend }}                      â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    # ========================================
    # Phase 1: äº‹å‰ãƒã‚§ãƒƒã‚¯
    # ========================================
    - name: "ğŸ” Phase 1: Pre-deployment Checks"
      include: "{{ playbook_dir }}/01-pre-checks.yml"

    # ========================================
    # Phase 2: Lambdaé–¢æ•°ãƒ‡ãƒ—ãƒ­ã‚¤
    # ========================================
    - name: "ğŸ“¦ Phase 2: Lambda Functions Deployment"
      include: "{{ playbook_dir }}/02-deploy-lambda.yml"
      when: deploy_lambda

    # ========================================
    # Phase 3: ECSã‚³ãƒ³ãƒ†ãƒŠãƒ‡ãƒ—ãƒ­ã‚¤
    # ========================================
    - name: "ğŸ³ Phase 3: ECS Container Deployment"
      include: "{{ playbook_dir }}/03-deploy-container.yml"
      when: deploy_container

    # ========================================
    # Phase 4: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤
    # ========================================
    - name: "ğŸŒ Phase 4: Frontend Deployment"
      include: "{{ playbook_dir }}/04-deploy-frontend.yml"
      when: deploy_frontend

    # ========================================
    # Phase 5: ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œæ¤œè¨¼
    # ========================================
    - name: "ğŸ¯ Phase 5: Post-deployment Verification"
      include: "{{ playbook_dir }}/05-post-verification.yml"

    - name: "ğŸ‰ Complete Deployment Summary"
      debug:
        msg: |
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘          ğŸ‰ DEPLOYMENT COMPLETED SUCCESSFULLY! ğŸ‰           â•‘
          â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
          â•‘                                                              â•‘
          â•‘  ğŸ“¦ All components have been deployed successfully!          â•‘
          â•‘                                                              â•‘
          â•‘  ğŸš€ Next Steps:                                              â•‘
          â•‘  1. Access the frontend URL to verify the dashboard         â•‘
          â•‘  2. Add YouTube channels for monitoring                      â•‘
          â•‘  3. Monitor CloudWatch logs for system health               â•‘
          â•‘                                                              â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
